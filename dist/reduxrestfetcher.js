!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("lodash")):"function"==typeof define&&define.amd?define(["exports","lodash"],e):e((t=t||self).reduxrestfetcher={},t.lodash)}(this,function(t,u){function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ownKeys(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),o.push.apply(o,r)}return o}function _objectSpread2(n){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(s,!0).forEach(function(t){var e,o,r;e=n,r=s[o=t],o in e?Object.defineProperty(e,o,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[o]=r}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):ownKeys(s).forEach(function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(s,t))})}return n}function g(){for(var e={},t=arguments.length,o=new Array(t),r=0;r<t;r++)o[r]=arguments[r];return o.forEach(function(t){t.constructor===Object&&(e=function mergeTwo(e,o){var r=o,n={};return Object.keys(e).forEach(function(t){"object"===_typeof(e[t])&&e[t].constructor!==Array?o[t]&&"object"===_typeof(o[t])?n[t]=mergeTwo(e[t],o[t]):n[t]=e[t]:e[t].constructor===Array?(n[t]=e[t],o[t]&&o[t].constructor===Array&&(n[t]=e[t].concat(o[t]))):o[t]?n[t]=o[t]:n[t]=e[t],delete r[t]}),n=Object.assign({},n,r)}(e,t))}),e}function h(o){if(u.isEmpty(o))return"";var r="?";return Object.keys(o).forEach(function(t,e){"object"!==_typeof(o[t])&&"function"!=typeof o[t]?r="".concat(r+(0!==e?"&":"")+t,"=").concat(o[t]):Array.isArray(o[t])&&(r="".concat(r+(0!==e?"&":"")+t,"=").concat(o[t].join(",")))}),r}function k(){var f=this;!function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,k),this.setBaseUrl=function(t){f.baseUrl=t},this.setPrefix=function(t){f.basePrefix=t},this.setFetch=function(t){var e=global||window;f.fetch=t.bind(e)},this.setBaseOptions=function(t){f.baseOptions=t},this.setDispatcher=function(t){f.dispatch=t.bind(f)},this.setGetState=function(t){f.getState=t},this.setFailedStatuses=function(t){f.failStatuses=t},this.getHelpers=function(){return _objectSpread2({},f.extraHelpers,{deepMerge:g,getGetParamsAsString:h})},this.addHelpers=function(t){f.extraHelpers=t},this.setEndpoints=function(o){Object.keys(o).forEach(function(e){f.endpointCreationPool.forEach(function(t){t(o[e],e)}),f.originalEndpoints[e]=o[e]})},this.addToPrefetchPool=function(t,e){var o=t.prefetch;o&&(u.isFunction(o)||u.isArray(o))&&(f.prefetchPool[e]=o)},this.addAsyncPrefetchPool=function(t,e){var o=t.asyncPrefetch;o&&u.isFunction(o)&&!u.isArray(o)&&(f.asyncPrefetchPool[e]=o)},this.addOnErrorPool=function(t,e){var o=t.onError;o&&(u.isFunction(o)||u.isArray(o))&&(f.errorPool[e]=o)},this.addOnSuccessPool=function(t,e){var o=t.onSuccess;o&&(u.isFunction(o)||u.isArray(o))&&(f.successPool[e]=o)},this.addToPostfetchPool=function(t,e){var o=t.postfetch;o&&(u.isFunction(o)||u.isArray(o))&&(f.postfetchPool[e]=o)},this.addEndpointAsClassFunction=function(t,r){var n=t.url,s=t.options,i=t.useEmptyHeaders;f[r]=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},o=2<arguments.length?arguments[2]:void 0;return f.baseFetch(n,s,t,e,r,o||i)},f.actions[r]=f[r]},this.runForError=function(e,t){var o=t.res,r=t.message;f.onError&&(u.isArray(f.onError)?f.onError:[f.onError]).forEach(function(t){t({name:e,response:o,message:r})});f.errorPool[e]&&(u.isArray(f.errorPool[e])?f.errorPool[e]:[f.errorPool[e]]).forEach(function(t){t({name:e,response:o,message:r})});f.dispatch&&f.actionError&&f.dispatch(f.actionError(e,o,r))},this.runPrefetchActions=function(t,e){return f.asyncPrefetchPool[t]&&f.getState?f.asyncPrefetchPool[t](e).then(function(t){return t?Promise.resolve(t):Promise.resolve(e)}):Promise.resolve(e)},this.baseFetch=function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{},n=4<arguments.length?arguments[4]:void 0,s=5<arguments.length&&void 0!==arguments[5]&&arguments[5];if(!f.fetch)throw new Error("rest-fetcher-base requires fetch to be defined. Since none was found in construction you probably forgot to add one manually");var i=o.expected||"json",c=g(f.baseOptions,e,r);s&&(c.headers={});var a={actions:f.actions,getState:f.getState,dispatch:f.dispatch,params:o,options:c,url:t,helpers:f.getHelpers()};return f.runPrefetchActions(n,a).then(function(t){var o=t;f.prefetchPool[n]&&f.getState&&(u.isArray(f.prefetchPool[n])?f.prefetchPool[n]:[f.prefetchPool[n]]).forEach(function(t){var e=t(o);e&&(o=g(a,e))});c=g(o.options,function getBody(t){return!!t.body&&(t.body instanceof FormData?{body:t.body}:"string"==typeof t.body?{body:t.body}:!!u.isObject(t.body)&&{body:JSON.stringify(t.body)})}(o.params));var e,r=function constructUrl(t,o,e){var r=t,n={};return-1===t.indexOf("http")&&(r="".concat(e).concat(t)),u.isObject(o)&&Object.keys(o).forEach(function(t){if(-1===l.indexOf(t)){var e=new RegExp(":".concat(t));e.test(r)?r=r.replace(e,o[t]):n[t]=o[t]}else"GET"===t&&(n=_objectSpread2({},n,{},o[t]))}),r+=h(n)}(o.url,o.params,f.baseUrl);return f.dispatch&&f.actionStart&&f.dispatch(f.actionStart(n,r,c)),f.fetch(r,c).then(function(t){return e={ok:t.ok,redirected:t.redirected,status:t.status,type:t.type,url:t.url},Promise.all([t[i](),Promise.resolve(e)])}).then(function(t){var o={actions:f.actions,getState:f.getState,dispatch:f.dispatch,data:t[0],response:t[1],helpers:f.getHelpers()};if(-1!==f.failStatuses.indexOf(t[1].status))f.runForError(n,{res:e,message:t[0]});else{if(f.successPool[n])(u.isArray(f.successPool[n])?f.successPool[n]:[f.successPool[n]]).forEach(function(t){var e=t(o);e&&(o=g(o,e))});f.dispatch&&f.actionEnd&&f.dispatch(f.actionEnd(n,t[0],t[1]))}return f.postfetchPool[n]?((u.isArray(f.postfetchPool[n])?f.postfetchPool[n]:[f.postfetchPool[n]]).forEach(function(t){var e=t(o);e&&(o=g(o,e))}),Promise.resolve(o.data)):Promise.resolve(t[0])}).catch(function(t){f.runForError(n,{message:t.message,res:e})})})},this.baseUrl="","undefined"!=typeof window&&"undefined"!=typeof fetch?this.fetch=fetch.bind(window):this.fetch=null,this.extraHelpers={},this.originalEndpoints={},this.reducerPool={},this.prefetchPool={},this.postfetchPool={},this.transformerPool={},this.asyncPrefetchPool={},this.successPool={},this.errorPool={},this.onError=[],this.endpointCreationPool=[this.addToPrefetchPool,this.addToPostfetchPool,this.addEndpointAsClassFunction,this.addAsyncPrefetchPool,this.addOnErrorPool,this.addOnSuccessPool],this.actions={},this.basePrefix="api(.)(.)",this.failStatuses=[400,401,402,403,404,405,406,407,408,409,500,501,502,503],this.baseOptions={credentials:"include",headers:{Accept:"application/json","Content-Type":"application/json",Cache:"no-cache",credentials:"same-origin"}}}var l=["body","expected","GET"],e=new k;t.Base=k,t.default=e,Object.defineProperty(t,"__esModule",{value:!0})});