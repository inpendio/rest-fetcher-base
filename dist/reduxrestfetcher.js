!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("lodash")):"function"==typeof define&&define.amd?define(["exports","lodash"],e):e(t.reduxrestfetcher={},t.lodash)}(this,function(t,h){function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _toConsumableArray(t){return function _arrayWithoutHoles(t){if(Array.isArray(t)){for(var e=0,o=new Array(t.length);e<t.length;e++)o[e]=t[e];return o}}(t)||function _iterableToArray(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var i=["body","expected","GET"],p=function deepMerge(){for(var e={},t=arguments.length,o=new Array(t),r=0;r<t;r++)o[r]=arguments[r];return o.forEach(function(t){t.constructor===Object&&(e=function mergeTwo(e,o){var r=o,n={};return Object.keys(e).forEach(function(t){"object"===_typeof(e[t])&&e[t].constructor!==Array?o[t]&&"object"===_typeof(o[t])?n[t]=mergeTwo(e[t],o[t]):n[t]=e[t]:e[t].constructor===Array?(n[t]=e[t],o[t]&&o[t].constructor===Array&&(n[t]=e[t].concat(o[t]))):o[t]?n[t]=o[t]:n[t]=e[t],delete r[t]}),n=Object.assign({},n,r)}(e,t))}),e},d=function constructUrl(t,o,e){var r=t,n={};return-1===t.indexOf("http")&&(r="".concat(e).concat(t)),h.isObject(o)&&Object.keys(o).forEach(function(t){if(-1===i.indexOf(t)){var e=new RegExp(":".concat(t));e.test(r)?r=r.replace(e,o[t]):n[t]=o[t]}else"GET"===t&&(n=function _objectSpread(n){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{},e=Object.keys(i);"function"==typeof Object.getOwnPropertySymbols&&(e=e.concat(Object.getOwnPropertySymbols(i).filter(function(t){return Object.getOwnPropertyDescriptor(i,t).enumerable}))),e.forEach(function(t){var e,o,r;e=n,r=i[o=t],o in e?Object.defineProperty(e,o,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[o]=r})}return n}({},n,o[t]))}),r+=function getGetParamsAsString(o){if(h.isEmpty(o))return"";var r="?";return Object.keys(o).forEach(function(t,e){"object"!==_typeof(o[t])&&"function"!=typeof o[t]&&(r="".concat(r+(0!==e?"&":"")+t,"=").concat(o[t]))}),r}(n)},e=function Communicator(){var l=this;!function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,Communicator),this.setBaseUrl=function(t){l.baseUrl=t},this.setPrefix=function(t){l.basePrefix=t},this.setFetch=function(t){l.fetch=t},this.setBaseOptions=function(t){l.baseOptions=t},this.setDispatcher=function(t){l.dispatch=t.bind(l)},this.getHelpers=function(){return{deepMerge:p}},this.setEndpoints=function(o){Object.keys(o).forEach(function(e){l.endpointCreationPool.forEach(function(t){t(o[e],e)}),l.originalEndpoints[e]=o[e]})},this.addToPrefetchPool=function(t,e){var o=t.prefetch;o&&(h.isFunction(o)||h.isArray(o))&&(l.prefetchPool[e]=o)},this.addToPostfetchPool=function(t,e){var o=t.postfetch;o&&(h.isFunction(o)||h.isArray(o))&&(l.postfetchPool[e]=o)},this.addEndpointAsClassFunction=function(t,r){var n=t.url,i=t.options,c=t.useEmptyHeaders;l[r]=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},o=2<arguments.length?arguments[2]:void 0;return l.baseFetch(n,i,t,e,r,o||c)},l.actions[r]=l[r]},this.baseFetch=function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{},n=4<arguments.length?arguments[4]:void 0,i=5<arguments.length&&void 0!==arguments[5]&&arguments[5],c=o.expected||"json",a=p(l.baseOptions,e,r);i&&(a={headers:{}});var s={actions:l.actions,getState:l.getState,dispatch:l.dispatch,params:o,options:a,url:t,helpers:l.getHelpers()};l.prefetchPool[n]&&l.getState&&(h.isArray(l.prefetchPool[n])?l.prefetchPool[n]:[l.prefetchPool[n]]).forEach(function(t){var e=t(s);e&&(s=p(s,e))});a=p(s.options,function getBody(t){return!!t.body&&("string"==typeof t.body?{body:t.body}:!!h.isObject(t.body)&&{body:JSON.stringify(t.body)})}(s.params));var f,u=d(s.url,s.params,l.baseUrl);return l.dispatch&&l.actionStart&&l.dispatch(l.actionStart(n,u,a)),l.fetch(u,a).then(function(t){return f={ok:t.ok,redirected:t.redirected,status:t.status,type:t.type,url:t.url},Promise.all([t[c](),Promise.resolve(f)])}).then(function(t){if(l.dispatch&&l.actionEnd&&l.dispatch(l.actionEnd(n,t[0],t[1])),l.postfetchPool[n]){var o={actions:l.actions,getState:l.getState,dispatch:l.dispatch,data:t[0],helpers:l.getHelpers()};return(h.isArray(l.postfetchPool[n])?l.postfetchPool[n]:[l.postfetchPool[n]]).forEach(function(t){var e=t(o);e&&(o=p(o,e))}),Promise.resolve(o.data)}return Promise.resolve(t[0])}).catch(function(t){l.dispatch&&l.actionError&&l.dispatch(l.actionError(n,f,t.message))})},this.baseUrl="",this.fetch=fetch?fetch.bind(window):null,this.originalEndpoints={},this.reducerPool={},this.prefetchPool={},this.postfetchPool={},this.transformerPool={},this.endpointCreationPool=[this.addToPrefetchPool,this.addToPostfetchPool,this.addEndpointAsClassFunction],this.actions={},this.basePrefix="api(.)(.)",this.baseOptions={credentials:"include",headers:{Accept:"application/json","Content-Type":"application/json",Cache:"no-cache",credentials:"same-origin"}}},o={object:function object(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};if(h.isObject(t))return t;var e=!1;if("string"==typeof t)try{e=JSON.parse(t.trim())}catch(t){console.log(t)}return e||h.toPlainObject(t)},array:function array(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return h.isArray?t:h.toArray(t)},cumulativeArray:function cumulativeArray(i){return function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[];if(!t)return e;if(!i)return e.concat(h.isArray(t)?t:h.toArray(t));var n=_toConsumableArray(e);return t.forEach(function(o){var r=!1;e.forEach(function(t,e){o[i]===t[i]&&(n[e]=o,r=!0)}),r||n.push(o)}),n}}},r=new e;t.default=r,t.transformers=o,t.Base=e,Object.defineProperty(t,"__esModule",{value:!0})});