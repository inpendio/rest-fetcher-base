!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("lodash")):"function"==typeof define&&define.amd?define(["exports","lodash"],e):e((t=t||self).reduxrestfetcher={},t.lodash)}(this,function(t,d){function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ownKeys(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),o.push.apply(o,n)}return o}function g(){for(var e={},t=arguments.length,o=new Array(t),n=0;n<t;n++)o[n]=arguments[n];return o.forEach(function(t){t.constructor===Object&&(e=function mergeTwo(e,o){var n=o,r={};return Object.keys(e).forEach(function(t){"object"===_typeof(e[t])&&e[t].constructor!==Array?o[t]&&"object"===_typeof(o[t])?r[t]=mergeTwo(e[t],o[t]):r[t]=e[t]:e[t].constructor===Array?(r[t]=e[t],o[t]&&o[t].constructor===Array&&(r[t]=e[t].concat(o[t]))):o[t]?r[t]=o[t]:r[t]=e[t],delete n[t]}),r=Object.assign({},r,n)}(e,t))}),e}function i(t,o,e){var n=t,r={};return-1===t.indexOf("http")&&(n="".concat(e).concat(t)),d.isObject(o)&&Object.keys(o).forEach(function(t){if(-1===s.indexOf(t)){var e=new RegExp(":".concat(t));e.test(n)?n=n.replace(e,o[t]):r[t]=o[t]}else"GET"===t&&(r=function _objectSpread2(r){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(i,!0).forEach(function(t){var e,o,n;e=r,n=i[o=t],o in e?Object.defineProperty(e,o,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[o]=n}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(i)):ownKeys(i).forEach(function(t){Object.defineProperty(r,t,Object.getOwnPropertyDescriptor(i,t))})}return r}({},r,{},o[t]))}),n+=function getGetParamsAsString(o){if(d.isEmpty(o))return"";var n="?";return Object.keys(o).forEach(function(t,e){"object"!==_typeof(o[t])&&"function"!=typeof o[t]&&(n="".concat(n+(0!==e?"&":"")+t,"=").concat(o[t]))}),n}(r)}function k(){var p=this;!function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,k),this.setBaseUrl=function(t){p.baseUrl=t},this.setPrefix=function(t){p.basePrefix=t},this.setFetch=function(t){var e=global||window;p.fetch=t.bind(e)},this.setBaseOptions=function(t){p.baseOptions=t},this.setDispatcher=function(t){p.dispatch=t.bind(p)},this.setGetState=function(t){p.getState=t},this.setFailedStatuses=function(t){p.failStatuses=t},this.getHelpers=function(){return{deepMerge:g}},this.setEndpoints=function(o){Object.keys(o).forEach(function(e){p.endpointCreationPool.forEach(function(t){t(o[e],e)}),p.originalEndpoints[e]=o[e]})},this.addToPrefetchPool=function(t,e){var o=t.prefetch;o&&(d.isFunction(o)||d.isArray(o))&&(p.prefetchPool[e]=o)},this.addToPostfetchPool=function(t,e){var o=t.postfetch;o&&(d.isFunction(o)||d.isArray(o))&&(p.postfetchPool[e]=o)},this.addEndpointAsClassFunction=function(t,n){var r=t.url,i=t.options,s=t.useEmptyHeaders;p[n]=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},o=2<arguments.length?arguments[2]:void 0;return p.baseFetch(r,i,t,e,n,o||s)},p.actions[n]=p[n]},this.baseFetch=function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{},r=4<arguments.length?arguments[4]:void 0,s=5<arguments.length&&void 0!==arguments[5]&&arguments[5];if(!p.fetch)throw new Error("rest-fetcher-base requires fetch to be defined. Since none was found in construction you probably forgot to add one manually");var c=o.expected||"json",a=g(p.baseOptions,e,n);s&&(a={headers:{}});var f={actions:p.actions,getState:p.getState,dispatch:p.dispatch,params:o,options:a,url:t,helpers:p.getHelpers()};p.prefetchPool[r]&&p.getState&&(d.isArray(p.prefetchPool[r])?p.prefetchPool[r]:[p.prefetchPool[r]]).forEach(function(t){var e=t(f);e&&(f=g(f,e))});a=g(f.options,function getBody(t){return!!t.body&&(t.body instanceof FormData?{body:t.body}:"string"==typeof t.body?{body:t.body}:!!d.isObject(t.body)&&{body:JSON.stringify(t.body)})}(f.params));var h,u=i(f.url,f.params,p.baseUrl);return p.dispatch&&p.actionStart&&p.dispatch(p.actionStart(r,u,a)),p.fetch(u,a).then(function(t){return h={ok:t.ok,redirected:t.redirected,status:t.status,type:t.type,url:t.url},Promise.all([t[c](),Promise.resolve(h)])}).then(function(t){if(-1!==p.failStatuses.indexOf(t[1].status)?p.dispatch(p.actionError(r,h,t[0])):p.dispatch&&p.actionEnd&&p.dispatch(p.actionEnd(r,t[0],t[1])),p.postfetchPool[r]){var o={actions:p.actions,getState:p.getState,dispatch:p.dispatch,data:t[0],helpers:p.getHelpers()};return(d.isArray(p.postfetchPool[r])?p.postfetchPool[r]:[p.postfetchPool[r]]).forEach(function(t){var e=t(o);e&&(o=g(o,e))}),Promise.resolve(o.data)}return Promise.resolve(t[0])}).catch(function(t){p.dispatch&&p.actionError&&p.dispatch(p.actionError(r,h,t.message))})},this.baseUrl="","undefined"!=typeof window&&"undefined"!=typeof fetch?this.fetch=fetch.bind(window):this.fetch=null,this.originalEndpoints={},this.reducerPool={},this.prefetchPool={},this.postfetchPool={},this.transformerPool={},this.endpointCreationPool=[this.addToPrefetchPool,this.addToPostfetchPool,this.addEndpointAsClassFunction],this.actions={},this.basePrefix="api(.)(.)",this.failStatuses=[400,401,402,403,404,405,406,407,408,409,500,501,502,503],this.baseOptions={credentials:"include",headers:{Accept:"application/json","Content-Type":"application/json",Cache:"no-cache",credentials:"same-origin"}}}var s=["body","expected","GET"],e=new k;t.Base=k,t.default=e,Object.defineProperty(t,"__esModule",{value:!0})});